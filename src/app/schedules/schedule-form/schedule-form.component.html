<mat-toolbar color="primary">
  <mat-toolbar-row>
    <a mat-icon-button routerLink="../">
      <mat-icon aria-label="Listado de pacientes">arrow_back</mat-icon>
    </a>
    <span *ngIf="!schedule">Agenda</span>
    <span *ngIf="schedule" class="header-row">
      Agenda - {{schedule.name}}
    </span>
    <span class="spacer"></span>
    <button mat-icon-button [matMenuTriggerFor]="menu">
      <mat-icon aria-label="Opciones de la agenda">more_vert</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item>
        <mat-icon>delete</mat-icon>
        <span>Eliminar</span>
      </button>
    </mat-menu>
  </mat-toolbar-row>
</mat-toolbar>
<mat-card class="main-card">
  <mat-spinner *ngIf="!schedule"></mat-spinner>
  <form method="post" [class]="formClass" [class.bolder]="biggerFont" #scheduleDataForm="ngForm">
    <mat-form-field class="form-field">
      <input matInput
      type="text"
      name="name"
      [(ngModel)]="schedule.name"
      placeholder="Nombre"
      maxlength="256"
      required
      (blur)="updateSchedule($event)">
    </mat-form-field>
    <mat-form-field class="form-field">
      <mat-select placeholder="Profesionales" [(ngModel)]="schedule.professionals" name="professionals" multiple>
        <mat-option *ngFor="let professional of professionals" [value]="professional">
          {{professional.lastname}} {{professional.name}}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field class="form-field">
      <input matInput
      name="start"
      [(ngModel)]="schedule.validityStart"
      placeholder="Inicio de vigencia"
      [matDatepicker]="startPicker"
      (dateChange)="updateSchedule($event)">
      <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
      <mat-datepicker touchUi #startPicker calendarLabel="Inicio de vigencia"></mat-datepicker>
    </mat-form-field>
    <mat-form-field class="form-field">
      <input matInput
      name="end"
      [(ngModel)]="schedule.validityEnd"
      placeholder="Fin de vigencia"
      [matDatepicker]="endPicker"
      (dateChange)="updateSchedule($event)">
      <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
      <mat-datepicker touchUi #endPicker calendarLabel="Fin de vigencia"></mat-datepicker>
    </mat-form-field>
    <mat-form-field class="form-field">
      <input matInput
      type="number"
      name="appointmentInterval"
      [(ngModel)]="schedule.appointmentInterval"
      placeholder="Intervalo entre turnos"
      maxlength="2"
      min="1"
      max="60"
      required
      (blur)="updateSchedule($event)">
    </mat-form-field>
    <mat-form-field class="form-field">
      <input matInput
      type="color"
      name="color"
      [(ngModel)]="schedule.color"
      placeholder="Color"
      (blur)="updateSchedule($event)">
    </mat-form-field>
    <div>

      <mat-card class="day-card" *ngFor="let day of WEEKDAYS; let i = index;">
        <mat-card-header>
          <mat-card-title>
            <mat-checkbox [(ngModel)]="schedule.days[i].active" name="day.id">{{day.name}}</mat-checkbox>
          </mat-card-title>
          <button mat-icon-button class="copy-hours" color="primary" (click)="applyHoursToAllDays(schedule.days, schedule.days[i].hours)">
            <mat-icon aria-label="Copiar los horarios a todos los dÃ­as">done_all</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
          <div class="hour-box" *ngFor="let hour of schedule.days[i].hours">
            <button mat-icon-button class="remove-hour" color="warn" (click)="removeHour(schedule.days[i], hour)">
              <mat-icon aria-label="Quitar este horario">remove_circle</mat-icon>
            </button>
            <span class="mat-caption">Desde</span>
            <app-hour-picker [hourAndMinutes]="hour.start"></app-hour-picker>
            <span class="mat-caption">Hasta</span>
            <app-hour-picker [hourAndMinutes]="hour.end"></app-hour-picker>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <button mat-stroked-button color="primary" (click)="addHour(schedule.days[i])">
            Agregar un horario
          </button>
        </mat-card-actions>
      </mat-card>

    </div>
  </form>
</mat-card>